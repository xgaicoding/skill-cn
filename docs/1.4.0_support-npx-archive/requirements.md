# Skill Hub 支持 NPX 下载指令需求文档（PRD）

版本：v1.4.0（Support NPX Download）  
日期：2026-02-04  
作者：TBD  

本文档用于明确 **Skill Hub 在 Skill 详情页支持「npx 下载/安装」指令的最小需求**：  
在 `skills` 表增加 `npx_download_command` 字段，并在 Skill 详情页的下载入口位置展示该指令，支持一键复制。

---

## 1. 背景与目标
### 1.1 背景
- 当前 Skill 详情页主要提供「下载 SKILL 包（ZIP）」或「前往官网下载」入口。
- 部分 Skill 更适合/只能通过 **npx 命令**获取或初始化（例如：脚手架、初始化器、一次性执行器）。
- 用户在看到 Skill 后，下一步常见动作是“复制命令立即使用”。若无明确入口，用户需要自行翻文档查找命令，链路断裂。

### 1.2 目标
- 新增字段 `npx_download_command` 用于存储该 Skill 的 npx 下载/安装指令。
- 在 **PC 端** Skill 详情页右侧操作区（原「下载 SKILL 包」按钮位置）展示该命令，并提供 **复制**能力。
- 当未配置 `npx_download_command` 时，保持现有下载逻辑不变（ZIP/外链）。

### 1.3 非目标（本期不做）
- 不做“命令合法性校验/自动生成命令”（仅存储与展示）。
- 不做命令执行（站内不运行 npx）。
- 不新增后台编辑页面（字段维护沿用现有 DB 运维/脚本/管理流程）。
- 不改首页卡片展示（仅 Skill 详情页下载入口区域）。
- 不新增 “复制次数统计/埋点” （如有需要后续单独迭代）。
- **移动端不做**：移动端 Skill 详情页无需展示 npx 命令块，也无需复制交互（避免移动端布局拥挤与交互干扰）。

---

## 2. 数据需求
### 2.1 表结构变更
在 `public.skills` 表新增字段：
- 字段名：`npx_download_command`
- 类型：`text`
- 默认值：`NULL`
- 约束：可空（不配置时不影响现有逻辑）

> 备注：不强制以 `npx ` 开头（避免过度约束）；由运营/维护方保证内容正确。

### 2.2 数据兼容/迁移
- 存量数据：默认 `NULL`，不改变现有展示。
- 新增/更新：对需要支持 npx 的 Skill，手动填充该字段即可生效。

---

## 3. 前端展示需求（Skill 详情页 - 仅 PC）
### 3.1 展示位置
- 页面：Skill 详情页（`/skill/[id]`）
- 位置：右侧操作区下载入口（当前「下载 SKILL 包」按钮所在区域）

### 3.2 展示规则
> 口径修正：npx 指令与「下载 ZIP 包」不冲突，为并行能力，展示在下载区域中（与 ZIP 下载并列，不互斥）。

1) 保持现有下载入口（置于上方）：
- 若 `supports_download_zip=true`：展示「下载 SKILL 包」
- 若 `supports_download_zip=false`：展示「前往官网下载」

2) 在上述下载入口**上方**，展示 npx 命令框：
- 当 `npx_download_command` **非空**（`trim()` 后长度 > 0）：
  - 直接展示命令（单行展示，超出省略/可横向滚动均可，视觉保持整洁）
  - 提供复制图标按钮（点击复制完整命令）
- 当 `npx_download_command` **为空**：
  - 不展示命令块（避免空内容误导用户）

### 3.3 交互与反馈
- 点击「复制」后，将 `npx_download_command` 写入剪贴板。
- 复制成功：给出明确反馈（如：Toast/轻提示“已复制”）。
- 复制失败（如部分 WebView 限制 Clipboard API）：
  - 至少提供降级方案：命令块可选中，提示用户“长按/手动复制”（具体 UI 可按现有 Toast 体系实现）。

### 3.4 视觉要求（口径）
- 命令块与站内既有按钮/输入框的视觉语言一致（圆角、阴影、字号、间距）。
- 命令展示建议使用等宽字体（monospace），强调“可复制命令”属性。
- 「复制」按钮/图标需要有清晰的触达热区与 hover/pressed 状态。
- 不引入高成本动效；如需动效仅使用 `opacity/transform`，并尊重 `prefers-reduced-motion`。

---

## 4. 接口/数据读取要求（口径）
- Skill 详情页读取 Skill 数据时，需要包含 `npx_download_command` 字段，以支持展示与复制。
- 其他页面/接口是否透出该字段不做强制要求，但建议统一透出，减少后续重复改动。

---

## 5. 验收标准
- 数据库 `skills` 表存在 `npx_download_command` 字段，类型为 `text`，默认 `NULL`。
- 任意 Skill 详情页：
  - 下载入口（ZIP/外链）与 v1.3.x 行为保持一致。
  - `npx_download_command` 为空：下载入口上方不展示 npx 命令框。
  - `npx_download_command` 非空：下载入口上方展示 npx 命令框，且复制功能可用；复制成功有明确反馈。
- 移动端 Skill 详情页：不要求展示 npx 命令块（本期不做移动端适配）。
