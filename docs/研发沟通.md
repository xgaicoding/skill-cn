# 研发沟通记录

基于 PRD 文档 (requirements.md) 的疑问整理，待产品澄清。

---

## 1. 数据同步相关

### 1.1 GitHub 信息拉取时机
**问题**：文档提到 Stars、作者信息、更新时间、SKILL.md "动态拉取"，但具体时机不明确。是每次页面加载实时拉取，还是有缓存/定时同步机制？8.1.7 提到"允许存在极短的同步延迟"，这个"极短"是多久？

**澄清**：这是个好问题。我认为应该在首次录入skill的时候，默认拉取一次git仓库的全部相关信息。然后在用户访问skill详情页的时候，服务端拉取并更新git相关信息。首页skill的展示、搜索、排序逻辑，直接读取数据库缓存，不需要拉取git信息

---

### 1.2 热度计算的边界情况
**问题**：4.1.2 提到如果 `repo_stars` 未拉取成功则 `heat_score` 为空。但如果 `practice_count > 0` 而 `repo_stars` 未拉取成功，热度是否也为空？还是可以只用 practice_score 计算？此外 `heat_score` 为空时是否仍参与排序（按 8.1.4 规则排末尾）？

**澄清**：答：这里改一下，拉取失败的情况下，默认使用数据库缓存，所以不会存在热度为“空”的情况

---

### 1.3 updated_at 口径（子目录）
**问题**：`updated_at` 取 `source_url` 对应目录的最新 commit 时间。如果 `source_url` 指向子目录，应如何定义“目录最新 commit”？按默认分支？是否只看该目录下文件变更？是否需要考虑子模块/子仓库？

**澄清**：指向子目录，就显示子目录的commit时间。举个例子，source_url为：https://github.com/anthropics/skills/tree/main/skills/frontend-design，那就展示frontend-design这个目录的commit时间。不需要考虑子模块和子仓库

---

## 2. 功能细节

### 2.1 搜索匹配规则
**问题**：8.1.5 提到搜索范围是 name + description + tag，但未说明是精确匹配还是模糊匹配？是否支持多关键词？

**澄清**：支持模糊匹配，MVP版本不需要支持多关键字

---

### 2.1.1 搜索与标签筛选叠加
**问题**：当用户同时使用搜索词与标签筛选时，执行顺序/逻辑是什么？是“先筛选再搜索”，还是“先搜索再筛选”？是否需要保留两者组合状态？

**澄清**：先筛选再搜索，取两者的交集

---

### 2.2 SKILL.md 相对路径判断
**问题**：4.1.3 提到 `./`、`../` 或不以 `http(s)://` 开头的资源链接视为相对路径。那么 `images/xxx.png` 这种格式是否也算相对路径？`#anchor`、`mailto:` 等是否需要视为“相对资源”触发纯文本展示？

**澄清**：都算，都触发纯文本展示

---

### 2.3 source_url 格式
**问题**：支持哪些具体格式？例如：
- `https://github.com/owner/repo`（仓库根目录）
- `https://github.com/owner/repo/tree/main/path/to/skill`（子目录）
- 是否支持非 main 分支？
另外，是否仅支持 GitHub 公开仓库？非 GitHub 或私有仓库是否直接不收录？

**澄清**：我不管格式是什么，我只关注这是否是一个合法的SKILL目录。举例：source_url为https://github.com/anthropics/skills/tree/main/skills/frontend-design，我只需要关注https://github.com/anthropics/skills/tree/main/skills/frontend-design/SKILL.md是否存在，若存在则视为合法
支持非main分之
是的，仅支持公开仓库
---

### 2.4 下载 ZIP（子目录）
**问题**：GitHub 默认只能下载整仓库 ZIP。若 `source_url` 指向子目录，PRD 要求“仅该目录 ZIP”。是否允许服务端打包子目录，还是可以降级为整仓库 ZIP？

**澄清**：打包子目录。举例：source_url为https://github.com/anthropics/skills/tree/main/skills/frontend-design，则打包frontend-design下所有的文件

---

### 2.5 Stars 展示格式
**问题**：Stars >= 1000 展示为 `1.2k` 形式的具体规则是什么？四舍五入还是向下取整？阈值例如 1249/1250 的展示期望？

**澄清**：四舍五入

---

### 2.6 practice_count 口径
**问题**：`practice_count` 是否只统计 `is_listed = true` 的实践？热度计算中的 `practice_count` 是否也只计入上架实践？

**澄清**：是的

---

### 2.7 点击/下载计数防刷
**问题**：`download_count` / `click_count` 是否需要任何去重或频控（同用户短时间重复点击）？若不需要，是否按“每次点击都 +1”口径实现即可？

**澄清**：不需要去重和控频率，每次点击+1即可

---

### 2.8 上架建议门槛
**问题**：`heat_score >= 1.6` 为建议门槛，是否需要在站内做任何提示/标记？当 `heat_score` 为空时是否忽略该门槛？

**澄清**：不需要做提示；heat_score不可能为空

---

### 2.9 SLA 处理承诺展示
**问题**：“3 天内处理”的 SLA 是否需要在站内展示文案，还是仅在 GitHub Issue 模板中说明即可？

**澄清**：仅在GitHub Issue 模板中说明即可

---

## 3. 交互细节

### 3.1 Banner 轮播边界
**问题**：8.1.8 提到不足 3 条不展示 Banner，但如果正好 3 条，是否需要轮播？还是静态展示？另外“不展示 Banner”是指整个 Banner 区域隐藏，还是只隐藏右侧轮播、保留左侧品牌区？

**澄清**：这里是由运营（我）手动配置的，不会存在不满3条的情况；不存在不展示Banner的情况

---

### 3.2 skill_id / practice_id 格式
**问题**：这些 ID 的格式要求是什么？自增数字、UUID、还是其他？

**澄清**：用自增数字

---

## 4. 二轮澄清（衍生问题）

### 4.1 详情页拉取方式
**问题**：1.1 提到"用户访问详情页时服务端拉取并更新"。这个拉取是同步阻塞（用户等待拉取完成）还是异步更新（先展示缓存，后台更新）？如果 GitHub API 超时/限流，详情页如何处理？

**澄清**：同步阻塞。效果就是给用户展示详情页，但git相关的信息都用骨架屏loading展示。git相关信息拉取完毕，同步数据库缓存，且返回给前端进行展示。如果 GitHub API 超时/限流，则展示数据库缓存git信息

---

### 4.2 锚点链接触发纯文本
**问题**：2.2 澄清 `#anchor` 也触发纯文本展示。但很多 SKILL.md 会有目录导航（如 `[安装](#安装)`），这意味着只要有内部锚点，整个文档都变成纯文本。这是否符合预期？还是说 `#anchor` 应该排除在外？

**澄清**：是的，展示纯文本，符合预期。通常情况下 SKILL.md 不会包含 图片、#anchor等，这种属于极端情况

---

### 4.3 首次录入失败处理
**问题**：首次录入 Skill 时如果 GitHub 拉取失败（网络问题、仓库不存在等），是否阻止录入？还是允许录入但 GitHub 相关字段使用默认值？

**澄清**：阻止录入

---

### 4.4 SKILL.md 缓存策略
**问题**：详情页的 SKILL.md 内容，是每次访问都实时拉取，还是有缓存时间（如 5 分钟内不重复拉取）？考虑到 GitHub API 有速率限制。

**澄清**：SKILL.md也属于git信息，缓存在数据库中

---

### 4.5 分支删除处理
**问题**：如果 source_url 指向的分支（如 `feature-x`）后来被删除了，详情页和下载功能如何处理？是否需要展示特定错误提示？

**澄清**：提示错误，并引导用户直接跳转到source_url

---

### 4.6 GitHub 信息刷新频率
**问题**：澄清中提到“详情页访问时拉取并更新、首页读取缓存”。与 PRD 中“页面刷新后应展示最新 Stars”存在潜在冲突。是否需要定时同步/TTL？若需要，“极短同步延迟”的具体时间是多少？

**澄清**：以澄清中的方案稳准。MVP版本不需要定时同步。MVP版本对同步延迟不做要求。

---

### 4.7 拉取失败且无缓存的默认值
**问题**：已明确“heat_score 不为空”。但首次录入或首次拉取失败且数据库无缓存时，`repo_stars` / `updated_at` / `heat_score` 的默认值应如何处理？（例如置 0、置 `-`、或仅用 `practice_count` 计算热度）

**澄清**：若首次录入失败/拉取失败，数据不要落库。只要数据不落库，就不会有这个问题

---

### 4.8 updated_at 子目录口径补充
**问题**：当 `source_url` 指向子目录时，“目录最新 commit 时间”是否包含该目录下的子目录文件变更？还是仅限于当前目录文件？

**澄清**：github，每个代码目录不是都会展示一个比如“2 month ago”吗，就按照这个口径取

---

### 4.9 source_url 兼容格式与归一化
**问题**：若用户提交的是 `.../blob/.../SKILL.md` 或 `.../raw/.../SKILL.md` 形式，是否需要系统做 URL 归一化为目录链接？还是要求用户必须提供目录链接？

**澄清**：不会存在这种情况，因为前期不对外部用户开放提交权限和编辑页面，前期都是由内部运营人员（我），来进行统一录入

---

### 4.10 下载 ZIP 分支口径
**问题**：当 `source_url` 未指定分支时，是否默认使用仓库默认分支？若 `source_url` 指向非 main 分支，打包是否必须严格使用该分支内容？

**澄清**：只支持默认分支就好，不需要考虑非默认分支的情况

---

### 4.11 搜索“模糊匹配”规则
**问题**：模糊匹配是否等同于简单 substring（SQL LIKE）即可？是否区分大小写？`tag` 字段也同样走模糊匹配吗？

**澄清**：是的，简单做，不需要区分大小写

---

### 4.12 Stars 展示格式细则
**问题**：四舍五入后保留几位小数？示例期望：`1000 -> 1.0k` 还是 `1k`，`1249/1250` 分别展示为何值？`>= 10000` 是否仍保留 1 位小数？

**澄清**：1.0k；展示1.2k和1.3k；展示10.0k

---

### 4.13 Banner 不足 3 条兜底
**问题**：虽然运营保证“不会不足 3 条”，实现上是否仍需保留兜底逻辑？若不足 3 条，应展示（简化）还是隐藏整个 Banner？

**澄清**：不足3条，就3条进行轮播即可

---

## 5. 三轮澄清（冲突与细节确认）

### 5.1 source_url 分支支持最终口径
**问题**：2.3 表示“支持非 main 分支”，但 4.10 又说“只支持默认分支”。最终口径到底是哪一个？若只支持默认分支，运营录入了非默认分支 URL 是否需要提示并强制改为默认分支？是否允许自动归一化到默认分支？

**澄清**：分支问题就不用纠结了，开发时以默认分支为准

---

### 5.2 Banner 不足 3 条时的实际展示
**问题**：口径中既提到“不会不足 3 条”，又提到“不足 3 条就 3 条轮播”。若实际只有 1–2 条时，最终展示策略是：仍展示并轮播现有条数 / 静态展示 / 隐藏整个 Banner？

**澄清**：仍展示并轮播现有条数

---

### 5.3 updated_at 目录口径落地描述
**问题**：你说"按 GitHub 目录显示的 '2 month ago' 口径"。是否可理解为"使用默认分支，取该目录及其子目录任意文件的最新 commit 时间"？如果不是，请给出更明确的实现描述。

**澄清**：取该目录及其子目录任意文件的最新 commit 时间

---

## 6. 四轮澄清（研发补充）

### 6.1 GitHub OAuth 登录态
**问题**：
1. 登录态有效期是多久？是否需要"记住登录"功能（关闭浏览器后保持登录）？
2. OAuth 回调失败时（如用户拒绝授权、网络问题），页面如何处理？是否需要错误提示？

**澄清**：就正常用Git的 OAuth登录就好了

---

### 6.2 详情页实践卡片数量
**问题**：如果某个 Skill 有大量实践（如 50+ 条），详情页的实践区是全部展示还是需要分页/折叠？若分页，每页多少条？

**澄清**：分页展示，页 5 条

---

### 6.3 分页状态与 URL
**问题**：
1. 目录页翻页后，URL 是否需要携带页码参数（如 `?page=2`）？方便用户分享特定页面。
2. 用户切换筛选条件（标签/排序/搜索）后，是否需要自动重置到第一页？

**澄清**：1. 不需要；2. 需要

---

### 6.4 GitHub Issue 仓库与模板
**问题**：
1. "提交 Skill"和"提交实践"跳转的 GitHub Issue 是同一个仓库还是不同仓库？
2. 两种提交是否需要使用不同的 Issue 模板（GitHub Issue Template 功能）？
3. Issue 仓库的具体地址是什么？（研发需要配置跳转链接）

**澄清**：1.是同一个仓库，只不过是不同的 Issue 模板；2.使用不同的 Issue 模板；3.具体地址待定

---

### 6.5 下载次数展示
**问题**：PRD 提到 `download_count` "仅记录，不做下载榜/排序"。但这个下载次数是否需要在详情页展示给用户看？如果展示，放在哪个位置？

**澄清**：是的，暂时不做展示，单纯只用于数据层面的记录

---

### 6.6 点击量/下载量展示格式
**问题**：实践的 `click_count` 和 Skill 的 `download_count`（若展示）是否也需要像 Stars 一样做千位缩写（如 `1.2k`）？

**澄清**：是的，统一；口径

---

### 6.7 Markdown 渲染能力范围
**问题**：SKILL.md 的 Markdown 渲染需要支持哪些能力？请确认：
1. 代码块是否需要语法高亮？
2. 表格是否需要支持？
3. 是否需要支持 GFM（GitHub Flavored Markdown）扩展语法（如任务列表 `- [x]`、删除线等）？

**澄清**：1.需要；2.需要；3.不需要

---

### 6.8 skill_id 复制交互
**问题**：8.2.2 提到详情页展示 `skill_id（可复制）`。这个"可复制"的交互形式是：
- 点击 ID 文本直接复制？
- 旁边有一个复制图标按钮？
- 复制成功后是否需要 Toast 提示？

**澄清**：点击 ID 文本直接复制，复制成功后，Toast 提示

---

### 6.9 移动端适配范围
**问题**：PRD 10.1 提到"移动端可浏览，MVP 至少保证核心页面可用"。"核心页面"具体包括哪些？是否仅指目录页和详情页？Banner 轮播在移动端是否需要特殊处理（如改为纵向滚动）？

**澄清**：这里更正下：MVP版本暂时可以不用考虑 移动端的兼容展示

---

### 6.10 首页与详情页的数据一致性
**问题**：用户在首页看到某 Skill 的 Stars 为 100，点进详情页后因实时拉取可能变成 105。这种首页缓存与详情页实时数据的"不一致"是否可接受？

**澄清** 可以接受

---
